<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Admin – Crispy Chicken</title>
  <link rel="icon" href="/public/assets/favicon.png" type="image/png" />
  <style>
    body{font-family:Arial,system-ui,sans-serif;margin:0;background:#0f0f0f;color:#fafafa}
    header{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:#222}
    .wrap{max-width:1000px;margin:20px auto;padding:0 16px}
    .card{background:#181818;border:1px solid #2a2a2a;border-radius:14px;padding:16px;margin-bottom:16px}
    input,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #333;background:#111;color:#eee}
    label{font-size:.9rem;opacity:.9}
    .grid{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    .grid-1{display:grid;gap:12px;grid-template-columns:1fr}
    button{padding:10px 14px;border-radius:10px;border:none;cursor:pointer}
    .primary{background:#f1b24a;color:#111;font-weight:700}
    .danger{background:#b30000;color:#fff}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .muted{opacity:.75}
    .hidden{display:none}
    #lock{position:fixed;inset:0;background:#000d;display:flex;align-items:center;justify-content:center}
    #lock .modal{background:#222;padding:24px;border-radius:14px;border:1px solid #333;max-width:360px;width:92%}
  </style>
</head>
<body>
  <div id="lock">
    <div class="modal">
      <h2>Admin Login</h2>
      <p class="muted">Enter password to access.</p>
      <input type="password" id="pwd" placeholder="Password" />
      <button class="primary" onclick="unlock()">Unlock</button>
      <p id="err" class="muted hidden">Wrong password.</p>
    </div>
  </div>

  <header>
    <strong>Admin Panel – Crispy Chicken</strong>
    <div class="row">
      <a class="muted" href="/">← Back to site</a>
      <button class="danger" onclick="lock()">Lock</button>
    </div>
  </header>

  <div class="wrap">
    <div class="card">
      <h3>Offer Content</h3>
      <div class="grid">
        <div>
          <label>Title (Arabic)</label>
          <input id="title_ar"/>
        </div>
        <div>
          <label>Title (English)</label>
          <input id="title_en"/>
        </div>
        <div>
          <label>Description (Arabic)</label>
          <textarea id="description_ar" rows="3"></textarea>
        </div>
        <div>
          <label>Description (English)</label>
          <textarea id="description_en" rows="3"></textarea>
        </div>
        <div>
          <label>Discount %</label>
          <input id="discount_percent" type="number" min="0" max="100"/>
        </div>
        <div>
          <label>Min order (AED)</label>
          <input id="min_order_aed" type="number" min="0"/>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>Contacts</h3>
      <div class="grid">
        <div><label>Hotline</label><input id="hotline"/></div>
        <div><label>Mobile (display)</label><input id="mobile"/></div>
        <div><label>WhatsApp (E.164 e.g. +971501882206)</label><input id="whatsapp_e164"/></div>
        <div><label>Email (receives messages)</label><input id="email"/></div>
      </div>
    </div>

    <div class="card">
      <h3>Social Links</h3>
      <div class="grid">
        <div><label>Facebook</label><input id="facebook"/></div>
        <div><label>Instagram</label><input id="instagram"/></div>
        <div><label>TikTok</label><input id="tiktok"/></div>
        <div><label>X (Twitter)</label><input id="x"/></div>
      </div>
    </div>

    <div class="card">
      <h3>Actions</h3>
      <div class="row">
        <button class="primary" onclick="downloadJSON()">Download offers.json</button>
        <button onclick="copyCurl()">Copy cURL (for API upload)</button>
      </div>
      <p class="muted">Upload <code>offers.json</code> to <code>/data/offers.json</code> in your GitHub repo, then Deploy on Vercel.</p>
    </div>

    <div class="card">
      <h3>Preview</h3>
      <div class="grid-1">
        <div id="preview" class="muted">Live preview will update as you type…</div>
      </div>
    </div>
  </div>

<script>
  const PASSWORD = "Crispy@123";
  const $ = (s)=>document.querySelector(s);
  let state = {};

  function lock(){ $('#lock').style.display='flex'; }
  function unlock(){
    const ok = $('#pwd').value === PASSWORD;
    $('#err').classList.toggle('hidden', ok);
    if(ok){ $('#lock').style.display='none'; }
  }

  async function load(){
    try{
      const res = await fetch('/data/offers.json', {cache:'no-store'});
      state = await res.json();
    }catch(e){
      state = {};
    }
    ['title_ar','title_en','description_ar','description_en','discount_percent','min_order_aed','hotline','mobile','whatsapp_e164','email'].forEach(id=>{
      if(state[id]!==undefined) $('#'+id).value = state[id];
    });
    if(state.social){
      ['facebook','instagram','tiktok','x'].forEach(k=>$('#'+k).value = state.social[k]||'');
    }
    bind();
    render();
  }

  function bind(){
    document.querySelectorAll('input,textarea').forEach(el=>{
      el.addEventListener('input', ()=>{
        const id = el.id;
        if(['facebook','instagram','tiktok','x'].includes(id)){
          state.social = state.social||{}; state.social[id]=el.value;
        } else {
          state[id]=el.value;
        }
        render();
      });
    });
  }

  function render(){
    $('#preview').innerText = JSON.stringify(state, null, 2);
  }

  function downloadJSON(){
    const blob = new Blob([JSON.stringify(state, null, 2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'offers.json';
    a.click();
  }

  function copyCurl(){
    const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(state))));
    const curl = `curl -X PUT -H "Authorization: token YOUR_GITHUB_TOKEN" -H "Content-Type: application/json" \
"https://api.github.com/repos/OWNER/REPO/contents/data/offers.json" \
-d "{ \\"message\\": \\"update offers\\", \\"content\\": \\"${encoded}\\" }"`;
    navigator.clipboard.writeText(curl);
    alert('cURL copied. Replace OWNER/REPO and YOUR_GITHUB_TOKEN before running.');
  }

  load();
  lock(); // show lock by default
</script>
</body>
</html>
